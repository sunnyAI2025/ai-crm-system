# CRMç³»ç»Ÿæµ‹è¯•æ•°æ®å‡†å¤‡è„šæœ¬

## æ¦‚è¿°

æœ¬æ–‡æ¡£æä¾›äº†CRMç³»ç»Ÿæµ‹è¯•æ‰€éœ€çš„å„ç§æµ‹è¯•æ•°æ®å‡†å¤‡è„šæœ¬ï¼ŒåŒ…æ‹¬æ•°æ®åº“æµ‹è¯•æ•°æ®ã€AIåŠŸèƒ½æµ‹è¯•æ•°æ®é›†ã€æ€§èƒ½æµ‹è¯•æ•°æ®å’Œæ¨¡æ‹Ÿæ•°æ®ç”Ÿæˆå·¥å…·ã€‚

## æ•°æ®åº“æµ‹è¯•æ•°æ®

### 1. åŸºç¡€æµ‹è¯•æ•°æ®è„šæœ¬

```sql
-- test_data_init.sql
-- CRMç³»ç»ŸåŸºç¡€æµ‹è¯•æ•°æ®åˆå§‹åŒ–è„šæœ¬

-- æ¸…ç†ç°æœ‰æµ‹è¯•æ•°æ®
DELETE FROM tracking_records WHERE id > 0;
DELETE FROM order_items WHERE id > 0;
DELETE FROM payments WHERE id > 0;
DELETE FROM orders WHERE id > 0;
DELETE FROM customers WHERE id > 0;
DELETE FROM leads WHERE id > 0;
DELETE FROM campaign_daily_stats WHERE id > 0;
DELETE FROM campaigns WHERE id > 0;
DELETE FROM users WHERE id > 1; -- ä¿ç•™ç®¡ç†å‘˜è´¦æˆ·
DELETE FROM roles WHERE id > 5;
DELETE FROM departments WHERE id > 4;

-- é‡ç½®åºåˆ—
ALTER SEQUENCE departments_id_seq RESTART WITH 5;
ALTER SEQUENCE roles_id_seq RESTART WITH 6;
ALTER SEQUENCE users_id_seq RESTART WITH 2;
ALTER SEQUENCE leads_id_seq RESTART WITH 1;
ALTER SEQUENCE customers_id_seq RESTART WITH 1;
ALTER SEQUENCE orders_id_seq RESTART WITH 1;
ALTER SEQUENCE campaigns_id_seq RESTART WITH 1;

-- æ’å…¥æµ‹è¯•éƒ¨é—¨æ•°æ®
INSERT INTO departments (id, name, description, parent_id, status, created_at, updated_at) VALUES
(5, 'æµ‹è¯•é”€å”®éƒ¨', 'ä¸“é—¨ç”¨äºæµ‹è¯•çš„é”€å”®éƒ¨é—¨', 2, 1, NOW(), NOW()),
(6, 'æµ‹è¯•è¥é”€éƒ¨', 'ä¸“é—¨ç”¨äºæµ‹è¯•çš„è¥é”€éƒ¨é—¨', 3, 1, NOW(), NOW()),
(7, 'æµ‹è¯•å®¢æœéƒ¨', 'ä¸“é—¨ç”¨äºæµ‹è¯•çš„å®¢æœéƒ¨é—¨', 1, 1, NOW(), NOW());

-- æ’å…¥æµ‹è¯•è§’è‰²æ•°æ®
INSERT INTO roles (id, name, description, department_id, permissions, status, created_at, updated_at) VALUES
(6, 'æµ‹è¯•é”€å”®ç»ç†', 'æµ‹è¯•ç”¨é”€å”®ç»ç†è§’è‰²', 5, '{"dashboard":{"view":true},"sales":{"leads":{"view":true,"create":true,"edit":true,"assign":true},"customers":{"view":true,"create":true,"edit":true},"orders":{"view":true,"create":true,"edit":true}}}', 1, NOW(), NOW()),
(7, 'æµ‹è¯•é”€å”®å‘˜', 'æµ‹è¯•ç”¨é”€å”®å‘˜è§’è‰²', 5, '{"sales":{"leads":{"view":true,"create":true,"edit":true},"customers":{"view":true,"create":true},"orders":{"view":true,"create":true}}}', 1, NOW(), NOW()),
(8, 'æµ‹è¯•è¥é”€å‘˜', 'æµ‹è¯•ç”¨è¥é”€å‘˜è§’è‰²', 6, '{"marketing":{"campaigns":{"view":true,"create":true,"edit":true}}}', 1, NOW(), NOW());

-- æ’å…¥æµ‹è¯•ç”¨æˆ·æ•°æ®
INSERT INTO users (username, password, name, phone, department_id, role_id, status, created_at, updated_at) VALUES
('test_sales_manager', '$2a$10$N.zmdr9k7uOCQb376NoUnuTJ8iAt6Z5EHsM7lbqxrDB3gF.eZBJvG', 'æµ‹è¯•é”€å”®ç»ç†', '13800001001', 5, 6, 1, NOW(), NOW()),
('test_sales_user1', '$2a$10$N.zmdr9k7uOCQb376NoUnuTJ8iAt6Z5EHsM7lbqxrDB3gF.eZBJvG', 'æµ‹è¯•é”€å”®å‘˜1', '13800001002', 5, 7, 1, NOW(), NOW()),
('test_sales_user2', '$2a$10$N.zmdr9k7uOCQb376NoUnuTJ8iAt6Z5EHsM7lbqxrDB3gF.eZBJvG', 'æµ‹è¯•é”€å”®å‘˜2', '13800001003', 5, 7, 1, NOW(), NOW()),
('test_marketing_user', '$2a$10$N.zmdr9k7uOCQb376NoUnuTJ8iAt6Z5EHsM7lbqxrDB3gF.eZBJvG', 'æµ‹è¯•è¥é”€å‘˜', '13800001004', 6, 8, 1, NOW(), NOW()),
('test_customer_service', '$2a$10$N.zmdr9k7uOCQb376NoUnuTJ8iAt6Z5EHsM7lbqxrDB3gF.eZBJvG', 'æµ‹è¯•å®¢æœ', '13800001005', 7, 4, 1, NOW(), NOW());

-- æ’å…¥æµ‹è¯•çº¿ç´¢æ•°æ®
INSERT INTO leads (name, phone, business_type, source_channel, intention_level, assigned_user_id, status, created_at, updated_at, remark) VALUES
('å¼ ä¸‰', '13900001001', 'ä¼šè®¡åŸ¹è®­', 'SEMæœç´¢', 1, 2, 1, NOW() - INTERVAL '10 days', NOW(), 'é€šè¿‡ç™¾åº¦æœç´¢æ‰¾åˆ°æˆ‘ä»¬ï¼Œå¯¹æ³¨å†Œä¼šè®¡å¸ˆè¯¾ç¨‹å¾ˆæ„Ÿå…´è¶£'),
('æå››', '13900001002', 'å­¦å†æå‡', 'è¡¨å•å¡«å†™', 2, 2, 1, NOW() - INTERVAL '8 days', NOW(), 'é€šè¿‡å®˜ç½‘è¡¨å•å’¨è¯¢æœ¬ç§‘å­¦å†æå‡'),
('ç‹äº”', '13900001003', 'èŒä¸šèµ„æ ¼', 'æµ·æŠ¥æ´»åŠ¨', 1, 3, 2, NOW() - INTERVAL '6 days', NOW(), 'çœ‹åˆ°åœ°é“å¹¿å‘Šåç”µè¯å’¨è¯¢äººåŠ›èµ„æºç®¡ç†å¸ˆ'),
('èµµå…­', '13900001004', 'æŠ€èƒ½åŸ¹è®­', 'ç”µè¯å’¨è¯¢', 3, 3, 1, NOW() - INTERVAL '4 days', NOW(), 'æœ‹å‹æ¨èï¼Œå’¨è¯¢ITæŠ€èƒ½åŸ¹è®­'),
('é’±ä¸ƒ', '13900001005', 'ä¼šè®¡åŸ¹è®­', 'SEMæœç´¢', 1, 2, 3, NOW() - INTERVAL '15 days', NOW(), 'å·²è½¬åŒ–ä¸ºå®¢æˆ·'),
('å­™å…«', '13900001006', 'å­¦å†æå‡', 'è¡¨å•å¡«å†™', 2, 2, 1, NOW() - INTERVAL '2 days', NOW(), 'ä¸“ç§‘æƒ³å‡æœ¬ç§‘'),
('å‘¨ä¹', '13900001007', 'èŒä¸šèµ„æ ¼', 'æµ·æŠ¥æ´»åŠ¨', 1, 3, 1, NOW() - INTERVAL '1 day', NOW(), 'å’¨è¯¢ä¸€çº§å»ºé€ å¸ˆè€ƒè¯•åŸ¹è®­'),
('å´å', '13900001008', 'ä¼šè®¡åŸ¹è®­', 'SEMæœç´¢', 2, 2, 2, NOW() - INTERVAL '12 days', NOW(), 'æ­£åœ¨è·Ÿè¿›ä¸­ï¼Œå·²å‘é€è¯¾ç¨‹èµ„æ–™');

-- æ’å…¥æµ‹è¯•å®¢æˆ·æ•°æ®
INSERT INTO customers (name, contact_person, phone, business_type, source_channel, customer_level, assigned_user_id, status, source_lead_id, created_at, updated_at, total_order_amount) VALUES
('é’±ä¸ƒ', 'é’±ä¸ƒ', '13900001005', 'ä¼šè®¡åŸ¹è®­', 'SEMæœç´¢', 'A', 2, 3, 5, NOW() - INTERVAL '14 days', NOW(), 4980.00),
('åŒ—äº¬ABCå…¬å¸', 'åˆ˜ç»ç†', '13900002001', 'èŒä¸šèµ„æ ¼', 'ç”µè¯å’¨è¯¢', 'B', 3, 1, NULL, NOW() - INTERVAL '30 days', NOW(), 0),
('ä¸Šæµ·XYZä¼ä¸š', 'é™ˆæ€»', '13900002002', 'æŠ€èƒ½åŸ¹è®­', 'è¡¨å•å¡«å†™', 'A', 2, 2, NULL, NOW() - INTERVAL '25 days', NOW(), 0),
('æ·±åœ³123æœ‰é™å…¬å¸', 'å¼ ä¸»ç®¡', '13900002003', 'å­¦å†æå‡', 'SEMæœç´¢', 'B', 3, 1, NULL, NOW() - INTERVAL '20 days', NOW(), 0);

-- æ’å…¥æµ‹è¯•è®¢å•æ•°æ®
INSERT INTO orders (order_no, customer_id, product_name, quantity, unit_price, total_amount, order_date, assigned_user_id, status, payment_status, paid_amount, service_start_date, service_end_date, created_at, updated_at) VALUES
('ORD202403150001', 1, 'æ³¨å†Œä¼šè®¡å¸ˆå…¨ç§‘ç­', 1, 4980.00, 4980.00, NOW() - INTERVAL '13 days', 2, 4, 3, 4980.00, NOW() - INTERVAL '7 days', NOW() + INTERVAL '60 days', NOW() - INTERVAL '13 days', NOW()),
('ORD202403160001', 2, 'äººåŠ›èµ„æºç®¡ç†å¸ˆäºŒçº§', 1, 2980.00, 2980.00, NOW() - INTERVAL '5 days', 3, 2, 1, 0, NOW() + INTERVAL '10 days', NOW() + INTERVAL '40 days', NOW() - INTERVAL '5 days', NOW()),
('ORD202403170001', 3, 'Javaå¼€å‘å·¥ç¨‹å¸ˆåŸ¹è®­', 1, 6980.00, 6980.00, NOW() - INTERVAL '3 days', 2, 1, 2, 3000.00, NOW() + INTERVAL '14 days', NOW() + INTERVAL '104 days', NOW() - INTERVAL '3 days', NOW());

-- æ’å…¥æµ‹è¯•æ”¯ä»˜è®°å½•
INSERT INTO payments (order_id, payment_amount, payment_method, payment_date, payment_status, transaction_no, created_at, updated_at, remark) VALUES
(1, 4980.00, 'æ”¯ä»˜å®', NOW() - INTERVAL '12 days', 1, 'PAY20240315001', NOW() - INTERVAL '12 days', NOW(), 'ä¸€æ¬¡æ€§ä»˜æ¸…'),
(3, 3000.00, 'é“¶è¡Œè½¬è´¦', NOW() - INTERVAL '2 days', 1, 'TRF20240317001', NOW() - INTERVAL '2 days', NOW(), 'é¦–æœŸä»˜æ¬¾');

-- æ’å…¥æµ‹è¯•è·Ÿè¸ªè®°å½•
INSERT INTO tracking_records (lead_id, customer_id, content, tracking_type, next_follow_time, created_by, created_at, updated_at) VALUES
(1, NULL, 'é¦–æ¬¡ç”µè¯è”ç³»ï¼Œå®¢æˆ·è¡¨ç¤ºå¯¹æ³¨å†Œä¼šè®¡å¸ˆåŸ¹è®­å¾ˆæ„Ÿå…´è¶£ï¼Œçº¦å®šæ˜å¤©è¯¦ç»†ä»‹ç»è¯¾ç¨‹', 'ç”µè¯æ²Ÿé€š', NOW() + INTERVAL '1 day', 2, NOW() - INTERVAL '9 days', NOW()),
(1, NULL, 'å‘é€äº†è¯¾ç¨‹è¯¦ç»†èµ„æ–™å’Œä»·æ ¼ï¼Œå®¢æˆ·éœ€è¦è€ƒè™‘å‡ å¤©', 'èµ„æ–™å‘é€', NOW() + INTERVAL '3 days', 2, NOW() - INTERVAL '7 days', NOW()),
(2, NULL, 'å®¢æˆ·å’¨è¯¢å­¦å†æå‡ç›¸å…³æ”¿ç­–ï¼Œå·²è¯¦ç»†è§£ç­”', 'ç”µè¯æ²Ÿé€š', NOW() + INTERVAL '2 days', 2, NOW() - INTERVAL '6 days', NOW()),
(3, NULL, 'å®¢æˆ·åˆ°è®¿å…¬å¸ï¼Œå®åœ°äº†è§£åŸ¹è®­ç¯å¢ƒå’Œå¸ˆèµ„åŠ›é‡', 'é¢è°ˆ', NOW() + INTERVAL '5 days', 3, NOW() - INTERVAL '4 days', NOW()),
(NULL, 1, 'å®¢æˆ·åé¦ˆè¯¾ç¨‹è¿›åº¦è‰¯å¥½ï¼Œå­¦ä¹ ç§¯ææ€§å¾ˆé«˜', 'å­¦ä¹ è·Ÿè¸ª', NOW() + INTERVAL '7 days', 2, NOW() - INTERVAL '3 days', NOW());

-- æ’å…¥æµ‹è¯•æ¨å¹¿æ´»åŠ¨æ•°æ®
INSERT INTO campaigns (name, description, start_date, end_date, budget, actual_cost, channel, target_audience, status, created_by, created_at, updated_at) VALUES
('æ˜¥å­£ä¼šè®¡åŸ¹è®­æ¨å¹¿', 'é’ˆå¯¹æ˜¥å­£æ‹›ç”Ÿçš„ä¼šè®¡åŸ¹è®­æ¨å¹¿æ´»åŠ¨', NOW() - INTERVAL '30 days', NOW() + INTERVAL '30 days', 50000.00, 25000.00, 'SEMæœç´¢', 'åœ¨èŒäººå‘˜', 1, 5, NOW() - INTERVAL '30 days', NOW()),
('å­¦å†æå‡ä¸“é¡¹æ´»åŠ¨', 'é’ˆå¯¹ä¸“ç§‘ç”Ÿçš„æœ¬ç§‘å­¦å†æå‡æ¨å¹¿', NOW() - INTERVAL '20 days', NOW() + INTERVAL '40 days', 30000.00, 18000.00, 'è¡¨å•å¡«å†™', 'ä¸“ç§‘æ¯•ä¸šç”Ÿ', 1, 5, NOW() - INTERVAL '20 days', NOW()),
('èŒä¸šèµ„æ ¼è€ƒè¯•å­£', 'é’ˆå¯¹å„ç±»èŒä¸šèµ„æ ¼è€ƒè¯•çš„æ¨å¹¿æ´»åŠ¨', NOW() - INTERVAL '15 days', NOW() + INTERVAL '45 days', 40000.00, 22000.00, 'æµ·æŠ¥æ´»åŠ¨', 'è€ƒè¯äººç¾¤', 1, 5, NOW() - INTERVAL '15 days', NOW());

-- æ’å…¥æµ‹è¯•æ´»åŠ¨ç»Ÿè®¡æ•°æ®
INSERT INTO campaign_daily_stats (campaign_id, stat_date, leads_count, cost, conversion_rate, created_at, updated_at) VALUES
(1, NOW() - INTERVAL '10 days', 15, 1200.00, 0.08, NOW() - INTERVAL '9 days', NOW()),
(1, NOW() - INTERVAL '9 days', 12, 1100.00, 0.10, NOW() - INTERVAL '8 days', NOW()),
(1, NOW() - INTERVAL '8 days', 18, 1350.00, 0.09, NOW() - INTERVAL '7 days', NOW()),
(2, NOW() - INTERVAL '10 days', 8, 800.00, 0.12, NOW() - INTERVAL '9 days', NOW()),
(2, NOW() - INTERVAL '9 days', 10, 950.00, 0.11, NOW() - INTERVAL '8 days', NOW()),
(3, NOW() - INTERVAL '8 days', 22, 1500.00, 0.07, NOW() - INTERVAL '7 days', NOW());

-- æ’å…¥æµ‹è¯•æ“ä½œæ—¥å¿—
INSERT INTO operation_logs (user_id, operation_type, resource_type, resource_id, operation_content, ip_address, created_at) VALUES
(2, 'CREATE', 'LEAD', 1, 'åˆ›å»ºçº¿ç´¢ï¼šå¼ ä¸‰', '192.168.1.100', NOW() - INTERVAL '10 days'),
(2, 'UPDATE', 'LEAD', 1, 'æ›´æ–°çº¿ç´¢è·Ÿè¸ªè®°å½•', '192.168.1.100', NOW() - INTERVAL '9 days'),
(2, 'CONVERT', 'LEAD', 5, 'çº¿ç´¢è½¬åŒ–ä¸ºå®¢æˆ·', '192.168.1.100', NOW() - INTERVAL '14 days'),
(2, 'CREATE', 'ORDER', 1, 'åˆ›å»ºè®¢å•ï¼šæ³¨å†Œä¼šè®¡å¸ˆå…¨ç§‘ç­', '192.168.1.101', NOW() - INTERVAL '13 days'),
(3, 'CREATE', 'LEAD', 3, 'åˆ›å»ºçº¿ç´¢ï¼šç‹äº”', '192.168.1.102', NOW() - INTERVAL '6 days');

COMMIT;
```

### 2. å¤§æ•°æ®é‡æµ‹è¯•æ•°æ®ç”Ÿæˆè„šæœ¬

```python
# scripts/generate_test_data.py
"""
CRMç³»ç»Ÿå¤§æ•°æ®é‡æµ‹è¯•æ•°æ®ç”Ÿæˆè„šæœ¬
"""

import random
import psycopg2
from datetime import datetime, timedelta
from faker import Faker
import os
from decimal import Decimal

# åˆå§‹åŒ–Faker
fake = Faker('zh_CN')

# æ•°æ®åº“è¿æ¥é…ç½®
DATABASE_URL = os.getenv('DATABASE_URL', 
    'postgresql://neondb_owner:npg_TCx79eZizfGU@ep-plain-moon-aewc6a58-pooler.c-2.us-east-2.aws.neon.tech/neondb?sslmode=require&channel_binding=require')

# ä¸šåŠ¡æ•°æ®é…ç½®
BUSINESS_TYPES = ['ä¼šè®¡åŸ¹è®­', 'å­¦å†æå‡', 'èŒä¸šèµ„æ ¼', 'æŠ€èƒ½åŸ¹è®­']
SOURCE_CHANNELS = ['SEMæœç´¢', 'è¡¨å•å¡«å†™', 'æµ·æŠ¥æ´»åŠ¨', 'ç”µè¯å’¨è¯¢']
CUSTOMER_LEVELS = ['A', 'B', 'C']
PRODUCT_NAMES = [
    'æ³¨å†Œä¼šè®¡å¸ˆå…¨ç§‘ç­', 'åˆçº§ä¼šè®¡èŒç§°', 'ä¸­çº§ä¼šè®¡èŒç§°',
    'ä¸“å‡æœ¬å­¦å†æå‡', 'æœ¬ç§‘å­¦å†æå‡', 'ç ”ç©¶ç”Ÿå­¦å†æå‡',
    'äººåŠ›èµ„æºç®¡ç†å¸ˆ', 'ä¸€çº§å»ºé€ å¸ˆ', 'äºŒçº§å»ºé€ å¸ˆ',
    'Javaå¼€å‘å·¥ç¨‹å¸ˆ', 'Pythonå¼€å‘å·¥ç¨‹å¸ˆ', 'Webå‰ç«¯å¼€å‘'
]
PAYMENT_METHODS = ['æ”¯ä»˜å®', 'å¾®ä¿¡æ”¯ä»˜', 'é“¶è¡Œè½¬è´¦', 'ç°é‡‘', 'åˆ·å¡']

class TestDataGenerator:
    def __init__(self):
        self.conn = psycopg2.connect(DATABASE_URL)
        self.cursor = self.conn.cursor()
    
    def close(self):
        """å…³é—­æ•°æ®åº“è¿æ¥"""
        self.cursor.close()
        self.conn.close()
    
    def generate_users(self, count=100):
        """ç”Ÿæˆæµ‹è¯•ç”¨æˆ·æ•°æ®"""
        print(f"ç”Ÿæˆ {count} ä¸ªæµ‹è¯•ç”¨æˆ·...")
        
        users_data = []
        for i in range(count):
            username = f"test_user_{i+1:04d}"
            name = fake.name()
            phone = fake.phone_number()
            department_id = random.randint(1, 7)
            role_id = random.randint(2, 8)
            status = 1
            
            users_data.append((
                username, 
                '$2a$10$N.zmdr9k7uOCQb376NoUnuTJ8iAt6Z5EHsM7lbqxrDB3gF.eZBJvG',  # é»˜è®¤å¯†ç 
                name, phone, department_id, role_id, status
            ))
        
        # æ‰¹é‡æ’å…¥
        insert_sql = """
        INSERT INTO users (username, password, name, phone, department_id, role_id, status, created_at, updated_at)
        VALUES (%s, %s, %s, %s, %s, %s, %s, NOW(), NOW())
        """
        
        self.cursor.executemany(insert_sql, users_data)
        self.conn.commit()
        print(f"âœ… æˆåŠŸç”Ÿæˆ {count} ä¸ªç”¨æˆ·")
    
    def generate_leads(self, count=5000):
        """ç”Ÿæˆæµ‹è¯•çº¿ç´¢æ•°æ®"""
        print(f"ç”Ÿæˆ {count} ä¸ªæµ‹è¯•çº¿ç´¢...")
        
        # è·å–ç”¨æˆ·IDåˆ—è¡¨
        self.cursor.execute("SELECT id FROM users WHERE role_id IN (3, 6, 7) AND status = 1")
        user_ids = [row[0] for row in self.cursor.fetchall()]
        
        if not user_ids:
            print("âŒ æ²¡æœ‰æ‰¾åˆ°é”€å”®å‘˜ç”¨æˆ·ï¼Œè¯·å…ˆç”Ÿæˆç”¨æˆ·æ•°æ®")
            return
        
        leads_data = []
        for i in range(count):
            name = fake.name()
            phone = fake.phone_number()
            business_type = random.choice(BUSINESS_TYPES)
            source_channel = random.choice(SOURCE_CHANNELS)
            intention_level = random.randint(1, 3)
            assigned_user_id = random.choice(user_ids)
            status = random.choices([1, 2, 3, 4], weights=[60, 25, 10, 5])[0]  # å¤§éƒ¨åˆ†æ˜¯å¾…è·Ÿè¿›
            
            # éšæœºç”Ÿæˆåˆ›å»ºæ—¶é—´ï¼ˆè¿‡å»90å¤©å†…ï¼‰
            created_at = fake.date_time_between(start_date='-90d', end_date='now')
            
            remark = self.generate_lead_remark(business_type, source_channel)
            
            leads_data.append((
                name, phone, business_type, source_channel, intention_level,
                assigned_user_id, status, created_at, created_at, remark
            ))
        
        # æ‰¹é‡æ’å…¥
        insert_sql = """
        INSERT INTO leads (name, phone, business_type, source_channel, intention_level, 
                          assigned_user_id, status, created_at, updated_at, remark)
        VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s)
        """
        
        self.cursor.executemany(insert_sql, leads_data)
        self.conn.commit()
        print(f"âœ… æˆåŠŸç”Ÿæˆ {count} ä¸ªçº¿ç´¢")
    
    def generate_customers(self, count=1000):
        """ç”Ÿæˆæµ‹è¯•å®¢æˆ·æ•°æ®"""
        print(f"ç”Ÿæˆ {count} ä¸ªæµ‹è¯•å®¢æˆ·...")
        
        # è·å–ç”¨æˆ·IDåˆ—è¡¨
        self.cursor.execute("SELECT id FROM users WHERE role_id IN (3, 6, 7) AND status = 1")
        user_ids = [row[0] for row in self.cursor.fetchall()]
        
        # è·å–å·²è½¬åŒ–çš„çº¿ç´¢IDåˆ—è¡¨
        self.cursor.execute("SELECT id FROM leads WHERE status = 3 LIMIT 200")
        lead_ids = [row[0] for row in self.cursor.fetchall()]
        
        customers_data = []
        for i in range(count):
            name = fake.company() if random.random() > 0.7 else fake.name()
            contact_person = fake.name()
            phone = fake.phone_number()
            business_type = random.choice(BUSINESS_TYPES)
            source_channel = random.choice(SOURCE_CHANNELS)
            customer_level = random.choice(CUSTOMER_LEVELS)
            assigned_user_id = random.choice(user_ids)
            status = random.choices([1, 2, 3, 4], weights=[40, 30, 25, 5])[0]
            
            # éƒ¨åˆ†å®¢æˆ·æ¥è‡ªçº¿ç´¢è½¬åŒ–
            source_lead_id = random.choice(lead_ids) if lead_ids and random.random() > 0.6 else None
            
            created_at = fake.date_time_between(start_date='-120d', end_date='now')
            
            # å·²æˆå•å®¢æˆ·è®¾ç½®è®¢å•é‡‘é¢
            total_order_amount = 0
            if status == 3:
                total_order_amount = random.randint(1000, 10000)
            
            customers_data.append((
                name, contact_person, phone, business_type, source_channel,
                customer_level, assigned_user_id, status, source_lead_id,
                created_at, created_at, total_order_amount
            ))
        
        insert_sql = """
        INSERT INTO customers (name, contact_person, phone, business_type, source_channel,
                              customer_level, assigned_user_id, status, source_lead_id,
                              created_at, updated_at, total_order_amount)
        VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)
        """
        
        self.cursor.executemany(insert_sql, customers_data)
        self.conn.commit()
        print(f"âœ… æˆåŠŸç”Ÿæˆ {count} ä¸ªå®¢æˆ·")
    
    def generate_orders(self, count=800):
        """ç”Ÿæˆæµ‹è¯•è®¢å•æ•°æ®"""
        print(f"ç”Ÿæˆ {count} ä¸ªæµ‹è¯•è®¢å•...")
        
        # è·å–å®¢æˆ·IDåˆ—è¡¨
        self.cursor.execute("SELECT id FROM customers WHERE status IN (2, 3)")
        customer_ids = [row[0] for row in self.cursor.fetchall()]
        
        if not customer_ids:
            print("âŒ æ²¡æœ‰æ‰¾åˆ°åˆé€‚çš„å®¢æˆ·ï¼Œè¯·å…ˆç”Ÿæˆå®¢æˆ·æ•°æ®")
            return
        
        # è·å–ç”¨æˆ·IDåˆ—è¡¨
        self.cursor.execute("SELECT id FROM users WHERE role_id IN (3, 6, 7) AND status = 1")
        user_ids = [row[0] for row in self.cursor.fetchall()]
        
        orders_data = []
        for i in range(count):
            order_no = f"ORD{datetime.now().strftime('%Y%m%d')}{i+1:05d}"
            customer_id = random.choice(customer_ids)
            product_name = random.choice(PRODUCT_NAMES)
            quantity = 1
            unit_price = Decimal(str(random.randint(1000, 15000)))
            total_amount = unit_price * quantity
            
            order_date = fake.date_time_between(start_date='-90d', end_date='now')
            assigned_user_id = random.choice(user_ids)
            
            # è®¢å•çŠ¶æ€åˆ†å¸ƒ
            status = random.choices([1, 2, 3, 4, 5, 6], weights=[20, 15, 10, 20, 30, 5])[0]
            
            # æ”¯ä»˜çŠ¶æ€
            if status >= 3:
                payment_status = random.choices([1, 2, 3], weights=[10, 30, 60])[0]
                paid_amount = 0
                if payment_status == 2:  # éƒ¨åˆ†ä»˜æ¬¾
                    paid_amount = total_amount * Decimal(str(random.uniform(0.3, 0.8)))
                elif payment_status == 3:  # å·²æ”¯ä»˜
                    paid_amount = total_amount
            else:
                payment_status = 1
                paid_amount = 0
            
            # æœåŠ¡æ—¶é—´
            service_start_date = order_date.date() + timedelta(days=random.randint(1, 30))
            service_end_date = service_start_date + timedelta(days=random.randint(30, 180))
            
            orders_data.append((
                order_no, customer_id, product_name, quantity, unit_price,
                total_amount, order_date, assigned_user_id, status,
                payment_status, paid_amount, service_start_date, service_end_date,
                order_date, order_date
            ))
        
        insert_sql = """
        INSERT INTO orders (order_no, customer_id, product_name, quantity, unit_price,
                           total_amount, order_date, assigned_user_id, status,
                           payment_status, paid_amount, service_start_date, service_end_date,
                           created_at, updated_at)
        VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)
        """
        
        self.cursor.executemany(insert_sql, orders_data)
        self.conn.commit()
        print(f"âœ… æˆåŠŸç”Ÿæˆ {count} ä¸ªè®¢å•")
    
    def generate_payments(self, count=1200):
        """ç”Ÿæˆæµ‹è¯•æ”¯ä»˜è®°å½•"""
        print(f"ç”Ÿæˆ {count} ä¸ªæµ‹è¯•æ”¯ä»˜è®°å½•...")
        
        # è·å–æœ‰æ”¯ä»˜é‡‘é¢çš„è®¢å•
        self.cursor.execute("""
        SELECT id, total_amount, paid_amount, created_at 
        FROM orders 
        WHERE payment_status IN (2, 3) AND paid_amount > 0
        """)
        orders = self.cursor.fetchall()
        
        if not orders:
            print("âŒ æ²¡æœ‰æ‰¾åˆ°æœ‰æ”¯ä»˜è®°å½•çš„è®¢å•")
            return
        
        payments_data = []
        for i in range(min(count, len(orders) * 3)):  # æ¯ä¸ªè®¢å•æœ€å¤š3ç¬”æ”¯ä»˜
            order = random.choice(orders)
            order_id, total_amount, paid_amount, order_date = order
            
            # ç”Ÿæˆæ”¯ä»˜é‡‘é¢ï¼ˆä¸è¶…è¿‡å·²æ”¯ä»˜é‡‘é¢ï¼‰
            max_payment = min(paid_amount, total_amount)
            payment_amount = Decimal(str(random.uniform(float(max_payment) * 0.3, float(max_payment))))
            
            payment_method = random.choice(PAYMENT_METHODS)
            payment_date = fake.date_time_between(start_date=order_date, end_date='now')
            payment_status = 1  # æ”¯ä»˜æˆåŠŸ
            transaction_no = f"PAY{payment_date.strftime('%Y%m%d%H%M%S')}{random.randint(1000, 9999)}"
            
            remark = self.generate_payment_remark(payment_method)
            
            payments_data.append((
                order_id, payment_amount, payment_method, payment_date,
                payment_status, transaction_no, payment_date, payment_date, remark
            ))
        
        insert_sql = """
        INSERT INTO payments (order_id, payment_amount, payment_method, payment_date,
                             payment_status, transaction_no, created_at, updated_at, remark)
        VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s)
        """
        
        self.cursor.executemany(insert_sql, payments_data)
        self.conn.commit()
        print(f"âœ… æˆåŠŸç”Ÿæˆ {len(payments_data)} ä¸ªæ”¯ä»˜è®°å½•")
    
    def generate_tracking_records(self, count=8000):
        """ç”Ÿæˆæµ‹è¯•è·Ÿè¸ªè®°å½•"""
        print(f"ç”Ÿæˆ {count} ä¸ªæµ‹è¯•è·Ÿè¸ªè®°å½•...")
        
        # è·å–çº¿ç´¢å’Œå®¢æˆ·ID
        self.cursor.execute("SELECT id FROM leads WHERE status IN (1, 2)")
        lead_ids = [row[0] for row in self.cursor.fetchall()]
        
        self.cursor.execute("SELECT id FROM customers WHERE status IN (1, 2, 3)")
        customer_ids = [row[0] for row in self.cursor.fetchall()]
        
        self.cursor.execute("SELECT id FROM users WHERE role_id IN (3, 4, 6, 7) AND status = 1")
        user_ids = [row[0] for row in self.cursor.fetchall()]
        
        tracking_types = ['ç”µè¯æ²Ÿé€š', 'é¢è°ˆ', 'èµ„æ–™å‘é€', 'é‚®ä»¶è”ç³»', 'å¾®ä¿¡æ²Ÿé€š', 'å›è®¿']
        
        tracking_data = []
        for i in range(count):
            # 70%è·Ÿè¸ªçº¿ç´¢ï¼Œ30%è·Ÿè¸ªå®¢æˆ·
            if random.random() < 0.7 and lead_ids:
                lead_id = random.choice(lead_ids)
                customer_id = None
            else:
                lead_id = None
                customer_id = random.choice(customer_ids) if customer_ids else None
            
            content = self.generate_tracking_content()
            tracking_type = random.choice(tracking_types)
            
            created_at = fake.date_time_between(start_date='-60d', end_date='now')
            next_follow_time = created_at + timedelta(days=random.randint(1, 14))
            created_by = random.choice(user_ids)
            
            tracking_data.append((
                lead_id, customer_id, content, tracking_type,
                next_follow_time, created_by, created_at, created_at
            ))
        
        insert_sql = """
        INSERT INTO tracking_records (lead_id, customer_id, content, tracking_type,
                                     next_follow_time, created_by, created_at, updated_at)
        VALUES (%s, %s, %s, %s, %s, %s, %s, %s)
        """
        
        self.cursor.executemany(insert_sql, tracking_data)
        self.conn.commit()
        print(f"âœ… æˆåŠŸç”Ÿæˆ {count} ä¸ªè·Ÿè¸ªè®°å½•")
    
    def generate_campaigns(self, count=50):
        """ç”Ÿæˆæµ‹è¯•æ¨å¹¿æ´»åŠ¨æ•°æ®"""
        print(f"ç”Ÿæˆ {count} ä¸ªæµ‹è¯•æ¨å¹¿æ´»åŠ¨...")
        
        self.cursor.execute("SELECT id FROM users WHERE role_id IN (2, 5, 8) AND status = 1")
        user_ids = [row[0] for row in self.cursor.fetchall()]
        
        campaigns_data = []
        for i in range(count):
            name = f"{random.choice(['æ˜¥å­£', 'å¤å­£', 'ç§‹å­£', 'å†¬å­£'])}{random.choice(BUSINESS_TYPES)}æ¨å¹¿æ´»åŠ¨{i+1}"
            description = f"é’ˆå¯¹{random.choice(['åœ¨èŒäººå‘˜', 'å­¦ç”Ÿç¾¤ä½“', 'ä¼ä¸šå®¢æˆ·', 'ä¸ªäººç”¨æˆ·'])}çš„ä¸“é¡¹æ¨å¹¿æ´»åŠ¨"
            
            start_date = fake.date_between(start_date='-180d', end_date='+30d')
            end_date = start_date + timedelta(days=random.randint(30, 90))
            
            budget = Decimal(str(random.randint(10000, 100000)))
            actual_cost = budget * Decimal(str(random.uniform(0.3, 0.9)))
            
            channel = random.choice(SOURCE_CHANNELS)
            target_audience = random.choice(['åœ¨èŒäººå‘˜', 'å­¦ç”Ÿç¾¤ä½“', 'ä¼ä¸šå®¢æˆ·', 'è€ƒè¯äººç¾¤'])
            status = random.choices([1, 2, 3], weights=[60, 20, 20])[0]
            created_by = random.choice(user_ids)
            
            campaigns_data.append((
                name, description, start_date, end_date, budget, actual_cost,
                channel, target_audience, status, created_by,
                start_date, start_date
            ))
        
        insert_sql = """
        INSERT INTO campaigns (name, description, start_date, end_date, budget, actual_cost,
                              channel, target_audience, status, created_by, created_at, updated_at)
        VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)
        """
        
        self.cursor.executemany(insert_sql, campaigns_data)
        self.conn.commit()
        print(f"âœ… æˆåŠŸç”Ÿæˆ {count} ä¸ªæ¨å¹¿æ´»åŠ¨")
    
    def generate_lead_remark(self, business_type, source_channel):
        """ç”Ÿæˆçº¿ç´¢å¤‡æ³¨"""
        remarks = {
            'ä¼šè®¡åŸ¹è®­': [
                'å¯¹æ³¨å†Œä¼šè®¡å¸ˆè¯¾ç¨‹å¾ˆæ„Ÿå…´è¶£ï¼Œè¯¢é—®è€ƒè¯•é€šè¿‡ç‡',
                'æƒ³äº†è§£åˆçº§ä¼šè®¡èŒç§°åŸ¹è®­çš„å…·ä½“å®‰æ’',
                'æ­£åœ¨å‡†å¤‡ä¸­çº§ä¼šè®¡è€ƒè¯•ï¼Œéœ€è¦ä¸“ä¸šæŒ‡å¯¼',
                'ä¼ä¸šè´¢åŠ¡äººå‘˜ï¼Œå¸Œæœ›æå‡ä¸“ä¸šæŠ€èƒ½'
            ],
            'å­¦å†æå‡': [
                'ä¸“ç§‘æ¯•ä¸šæƒ³å‡æœ¬ç§‘ï¼Œå’¨è¯¢ç›¸å…³æ”¿ç­–',
                'åœ¨èŒäººå‘˜ï¼Œå¸Œæœ›é€šè¿‡å­¦å†æå‡è·å¾—æ™‹å‡æœºä¼š',
                'äº†è§£ç½‘ç»œæ•™è‚²å’Œæˆäººé«˜è€ƒçš„åŒºåˆ«',
                'æƒ³æŠ¥è¯»ç ”ç©¶ç”Ÿè¯¾ç¨‹ï¼Œè¯¢é—®å…¥å­¦æ¡ä»¶'
            ],
            'èŒä¸šèµ„æ ¼': [
                'å‡†å¤‡è€ƒäººåŠ›èµ„æºç®¡ç†å¸ˆï¼Œè¯¢é—®åŸ¹è®­å®‰æ’',
                'å»ºç­‘è¡Œä¸šä»ä¸šè€…ï¼Œéœ€è¦ä¸€çº§å»ºé€ å¸ˆè¯ä¹¦',
                'å¯¹å¿ƒç†å’¨è¯¢å¸ˆèŒä¸šå¾ˆæ„Ÿå…´è¶£',
                'ä¼ä¸šç®¡ç†äººå‘˜ï¼Œæƒ³è€ƒå–é¡¹ç›®ç®¡ç†å¸ˆ'
            ],
            'æŠ€èƒ½åŸ¹è®­': [
                'é›¶åŸºç¡€æƒ³å­¦Javaå¼€å‘ï¼Œè¯¢é—®å°±ä¸šå‰æ™¯',
                'è®¾è®¡å¸ˆæƒ³å­¦UI/UXè®¾è®¡è¯¾ç¨‹',
                'å¯¹Pythonæ•°æ®åˆ†æå¾ˆæ„Ÿå…´è¶£',
                'æƒ³è½¬è¡Œåšå‰ç«¯å¼€å‘ï¼Œéœ€è¦ç³»ç»Ÿå­¦ä¹ '
            ]
        }
        
        channel_prefixes = {
            'SEMæœç´¢': 'é€šè¿‡æœç´¢å¼•æ“æ‰¾åˆ°æˆ‘ä»¬ï¼Œ',
            'è¡¨å•å¡«å†™': 'é€šè¿‡å®˜ç½‘è¡¨å•å’¨è¯¢ï¼Œ',
            'æµ·æŠ¥æ´»åŠ¨': 'çœ‹åˆ°å®£ä¼ å¹¿å‘Šåè”ç³»ï¼Œ',
            'ç”µè¯å’¨è¯¢': 'æœ‹å‹æ¨èåç”µè¯å’¨è¯¢ï¼Œ'
        }
        
        prefix = channel_prefixes.get(source_channel, '')
        remark_list = remarks.get(business_type, ['ä¸€èˆ¬å’¨è¯¢'])
        
        return prefix + random.choice(remark_list)
    
    def generate_payment_remark(self, payment_method):
        """ç”Ÿæˆæ”¯ä»˜å¤‡æ³¨"""
        remarks = {
            'æ”¯ä»˜å®': ['æ”¯ä»˜å®æ‰«ç æ”¯ä»˜', 'æ”¯ä»˜å®è½¬è´¦', 'èŠ±å‘—åˆ†æœŸæ”¯ä»˜'],
            'å¾®ä¿¡æ”¯ä»˜': ['å¾®ä¿¡æ‰«ç æ”¯ä»˜', 'å¾®ä¿¡è½¬è´¦', 'å¾®ä¿¡é›¶é’±æ”¯ä»˜'],
            'é“¶è¡Œè½¬è´¦': ['ç½‘é“¶è½¬è´¦', 'æ‰‹æœºé“¶è¡Œè½¬è´¦', 'ATMè½¬è´¦'],
            'ç°é‡‘': ['ç°é‡‘æ”¯ä»˜', 'ç°åœºç¼´è´¹'],
            'åˆ·å¡': ['ä¿¡ç”¨å¡æ”¯ä»˜', 'å‚¨è“„å¡æ”¯ä»˜']
        }
        
        method_remarks = remarks.get(payment_method, ['åœ¨çº¿æ”¯ä»˜'])
        return random.choice(method_remarks)
    
    def generate_tracking_content(self):
        """ç”Ÿæˆè·Ÿè¸ªå†…å®¹"""
        contents = [
            'ç”µè¯è”ç³»å®¢æˆ·ï¼Œäº†è§£å…·ä½“éœ€æ±‚å’Œé¢„ç®—æƒ…å†µ',
            'å‘é€äº†è¯¦ç»†çš„è¯¾ç¨‹ä»‹ç»å’Œä»·æ ¼æ–¹æ¡ˆ',
            'å®¢æˆ·è¡¨ç¤ºéœ€è¦å’Œå®¶äººå•†é‡ï¼Œçº¦å®šä¸‹æ¬¡è”ç³»æ—¶é—´',
            'é‚€è¯·å®¢æˆ·åˆ°å…¬å¸å®åœ°å‚è§‚å’Œè¯•å¬è¯¾ç¨‹',
            'å®¢æˆ·å¯¹ä»·æ ¼æœ‰ç–‘è™‘ï¼Œéœ€è¦è¿›ä¸€æ­¥æ²Ÿé€š',
            'å‘é€äº†å­¦å‘˜å°±ä¸šæ¡ˆä¾‹å’ŒæˆåŠŸæ•…äº‹',
            'å®¢æˆ·å†³å®šæŠ¥åï¼Œå‡†å¤‡ç­¾ç½²åŸ¹è®­åˆåŒ',
            'è·Ÿè¿›å­¦ä¹ è¿›åº¦ï¼Œå®¢æˆ·åé¦ˆè‰¯å¥½',
            'è§£ç­”å®¢æˆ·å…³äºè€ƒè¯•æ”¿ç­–çš„ç–‘é—®',
            'æé†’å®¢æˆ·æŒ‰æ—¶å‚åŠ åŸ¹è®­è¯¾ç¨‹'
        ]
        
        return random.choice(contents)
    
    def generate_all_test_data(self):
        """ç”Ÿæˆæ‰€æœ‰æµ‹è¯•æ•°æ®"""
        print("ğŸš€ å¼€å§‹ç”ŸæˆCRMç³»ç»Ÿæµ‹è¯•æ•°æ®...")
        
        try:
            # æŒ‰ä¾èµ–å…³ç³»ç”Ÿæˆæ•°æ®
            self.generate_users(100)
            self.generate_leads(5000)
            self.generate_customers(1000)
            self.generate_orders(800)
            self.generate_payments(1200)
            self.generate_tracking_records(8000)
            self.generate_campaigns(50)
            
            print("âœ… æ‰€æœ‰æµ‹è¯•æ•°æ®ç”Ÿæˆå®Œæˆï¼")
            
            # æ˜¾ç¤ºæ•°æ®ç»Ÿè®¡
            self.show_data_statistics()
            
        except Exception as e:
            print(f"âŒ ç”Ÿæˆæµ‹è¯•æ•°æ®æ—¶å‡ºé”™: {e}")
            self.conn.rollback()
        finally:
            self.close()
    
    def show_data_statistics(self):
        """æ˜¾ç¤ºæ•°æ®ç»Ÿè®¡ä¿¡æ¯"""
        print("\nğŸ“Š æ•°æ®ç»Ÿè®¡ä¿¡æ¯:")
        
        tables = [
            ('users', 'ç”¨æˆ·'),
            ('leads', 'çº¿ç´¢'),
            ('customers', 'å®¢æˆ·'),
            ('orders', 'è®¢å•'),
            ('payments', 'æ”¯ä»˜è®°å½•'),
            ('tracking_records', 'è·Ÿè¸ªè®°å½•'),
            ('campaigns', 'æ¨å¹¿æ´»åŠ¨')
        ]
        
        for table, name in tables:
            self.cursor.execute(f"SELECT COUNT(*) FROM {table}")
            count = self.cursor.fetchone()[0]
            print(f"  {name}: {count:,} æ¡")

if __name__ == "__main__":
    generator = TestDataGenerator()
    generator.generate_all_test_data()
```

### 3. AIåŠŸèƒ½æµ‹è¯•æ•°æ®é›†

```python
# scripts/generate_ai_test_data.py
"""
AIåŠŸèƒ½æµ‹è¯•æ•°æ®é›†ç”Ÿæˆè„šæœ¬
"""

import pandas as pd
import numpy as np
import random
from datetime import datetime, timedelta
import json
import os

class AITestDataGenerator:
    def __init__(self):
        self.output_dir = "test_data/ai_datasets"
        os.makedirs(self.output_dir, exist_ok=True)
    
    def generate_sales_trend_data(self):
        """ç”Ÿæˆé”€å”®è¶‹åŠ¿é¢„æµ‹æµ‹è¯•æ•°æ®"""
        print("ç”Ÿæˆé”€å”®è¶‹åŠ¿é¢„æµ‹æµ‹è¯•æ•°æ®...")
        
        # ç”Ÿæˆ24ä¸ªæœˆçš„å†å²æ•°æ®
        dates = pd.date_range(start='2022-01-01', end='2023-12-31', freq='M')
        
        # åŸºç¡€è¶‹åŠ¿ï¼šé€æœˆå¢é•¿
        base_trend = np.linspace(30000, 60000, len(dates))
        
        # å­£èŠ‚æ€§å½±å“
        seasonal = np.sin(np.arange(len(dates)) * 2 * np.pi / 12) * 5000
        
        # éšæœºæ³¢åŠ¨
        noise = np.random.normal(0, 3000, len(dates))
        
        # åˆæˆæ”¶å…¥æ•°æ®
        revenue = base_trend + seasonal + noise
        
        # ç”Ÿæˆç›¸å…³æŒ‡æ ‡
        order_count = (revenue / 300 + np.random.normal(0, 20, len(dates))).astype(int)
        unique_customers = (order_count * 0.8 + np.random.normal(0, 10, len(dates))).astype(int)
        avg_order_value = revenue / order_count
        
        # è¥é”€æ”¯å‡ºæ•°æ®
        marketing_spend = revenue * 0.15 + np.random.normal(0, 2000, len(dates))
        
        data = pd.DataFrame({
            'date': dates,
            'revenue': revenue.round(2),
            'order_count': order_count,
            'unique_customers': unique_customers,
            'avg_order_value': avg_order_value.round(2),
            'marketing_spend': marketing_spend.round(2),
            'month': dates.month,
            'quarter': dates.quarter,
            'year': dates.year
        })
        
        data.to_csv(f"{self.output_dir}/sales_trend_data.csv", index=False)
        print(f"âœ… é”€å”®è¶‹åŠ¿æ•°æ®å·²ä¿å­˜åˆ° {self.output_dir}/sales_trend_data.csv")
        
        return data
    
    def generate_customer_churn_data(self):
        """ç”Ÿæˆå®¢æˆ·æµå¤±é¢„æµ‹æµ‹è¯•æ•°æ®"""
        print("ç”Ÿæˆå®¢æˆ·æµå¤±é¢„æµ‹æµ‹è¯•æ•°æ®...")
        
        n_customers = 2000
        
        # ç”Ÿæˆå®¢æˆ·ç‰¹å¾
        data = {
            'customer_id': range(1, n_customers + 1),
            'days_since_last_order': np.random.exponential(30, n_customers),
            'order_frequency': np.random.gamma(2, 0.5, n_customers),
            'avg_order_value': np.random.normal(500, 200, n_customers),
            'total_spent': np.random.lognormal(8, 1, n_customers),
            'interaction_frequency': np.random.gamma(1.5, 2, n_customers),
            'days_since_last_contact': np.random.exponential(20, n_customers),
            'support_ticket_count': np.random.poisson(1, n_customers),
            'payment_delay': np.random.exponential(5, n_customers),
            'customer_age': np.random.uniform(30, 730, n_customers),
            'business_type': np.random.choice([0, 1, 2, 3], n_customers),  # ç¼–ç åçš„ä¸šåŠ¡ç±»å‹
            'source_channel': np.random.choice([0, 1, 2, 3], n_customers)  # ç¼–ç åçš„æ¥æºæ¸ é“
        }
        
        df = pd.DataFrame(data)
        
        # ç”Ÿæˆæµå¤±æ ‡ç­¾ï¼ˆåŸºäºç‰¹å¾çš„é€»è¾‘è§„åˆ™ï¼‰
        churn_probability = (
            0.3 * (df['days_since_last_order'] > 60) +
            0.2 * (df['order_frequency'] < 1) +
            0.2 * (df['days_since_last_contact'] > 30) +
            0.1 * (df['support_ticket_count'] > 2) +
            0.1 * (df['payment_delay'] > 10) +
            0.1 * np.random.random(n_customers)
        )
        
        df['churn'] = (churn_probability > 0.5).astype(int)
        df['churn_probability'] = churn_probability
        
        df.to_csv(f"{self.output_dir}/customer_churn_data.csv", index=False)
        print(f"âœ… å®¢æˆ·æµå¤±æ•°æ®å·²ä¿å­˜åˆ° {self.output_dir}/customer_churn_data.csv")
        
        return df
    
    def generate_sentiment_analysis_data(self):
        """ç”Ÿæˆæƒ…æ„Ÿåˆ†ææµ‹è¯•æ•°æ®"""
        print("ç”Ÿæˆæƒ…æ„Ÿåˆ†ææµ‹è¯•æ•°æ®...")
        
        # æ­£é¢è¯„ä»·æ ·æœ¬
        positive_texts = [
            "è¯¾ç¨‹å†…å®¹éå¸¸ä¸°å¯Œï¼Œè€å¸ˆè®²è§£å¾ˆè¯¦ç»†ï¼Œå­¦åˆ°äº†å¾ˆå¤šå®ç”¨çš„çŸ¥è¯†",
            "æœåŠ¡æ€åº¦å¾ˆå¥½ï¼Œå®¢æœå›å¤åŠæ—¶ï¼Œè§£å†³äº†æˆ‘çš„é—®é¢˜",
            "åŸ¹è®­æ•ˆæœè¶…å‡ºé¢„æœŸï¼Œæ¨èç»™æœ‹å‹äº†",
            "ä»·æ ¼åˆç†ï¼Œæ€§ä»·æ¯”å¾ˆé«˜ï¼Œå€¼å¾—æ¨è",
            "è€å¸ˆä¸“ä¸šæ°´å¹³å¾ˆé«˜ï¼Œè¯¾ç¨‹å®‰æ’åˆç†",
            "å­¦ä¹ ç¯å¢ƒå¾ˆå¥½ï¼Œè®¾æ–½å®Œå–„",
            "è¯¾ç¨‹æ›´æ–°åŠæ—¶ï¼Œè·Ÿä¸Šäº†è¡Œä¸šå‘å±•è¶‹åŠ¿",
            "è€ƒè¯•é€šè¿‡ç‡å¾ˆé«˜ï¼ŒåŸ¹è®­æ•ˆæœæ˜æ˜¾"
        ]
        
        # è´Ÿé¢è¯„ä»·æ ·æœ¬
        negative_texts = [
            "è¯¾ç¨‹å†…å®¹è¿‡æ—¶ï¼Œä¸å®é™…å·¥ä½œè„±èŠ‚",
            "æœåŠ¡æ€åº¦å·®ï¼Œå®¢æœå›å¤å¾ˆæ…¢",
            "ä»·æ ¼å¤ªè´µï¼Œæ€§ä»·æ¯”ä¸é«˜",
            "è€å¸ˆæ°´å¹³ä¸€èˆ¬ï¼Œè®²è§£ä¸å¤Ÿæ¸…æ¥š",
            "æ•™å­¦è®¾æ–½é™ˆæ—§ï¼Œå­¦ä¹ ç¯å¢ƒå·®",
            "è¯¾ç¨‹å®‰æ’ä¸åˆç†ï¼Œæ—¶é—´å†²çª",
            "è€ƒè¯•é€šè¿‡ç‡ä½ï¼ŒåŸ¹è®­æ•ˆæœä¸æ˜æ˜¾",
            "é€€è´¹å›°éš¾ï¼ŒæœåŠ¡ä½“éªŒå·®"
        ]
        
        # ä¸­æ€§è¯„ä»·æ ·æœ¬
        neutral_texts = [
            "è¯¾ç¨‹è¿˜å¯ä»¥ï¼Œæœ‰ä¸€å®šçš„å¸®åŠ©",
            "è€å¸ˆè®²è¯¾ä¸€èˆ¬ï¼Œæ²¡æœ‰ç‰¹åˆ«çªå‡ºçš„åœ°æ–¹",
            "ä»·æ ¼é€‚ä¸­ï¼Œè¯¾ç¨‹å†…å®¹åŸºæœ¬æ»¡è¶³éœ€æ±‚",
            "æœåŠ¡è¿˜è¡Œï¼Œæœ‰æ”¹è¿›çš„ç©ºé—´",
            "æ•´ä½“æ„Ÿè§‰è¿˜ä¸é”™ï¼Œæœ‰æ”¶è·",
            "è¯¾ç¨‹å®‰æ’åŸºæœ¬åˆç†ï¼Œå†…å®¹æ¯”è¾ƒå…¨é¢",
            "å­¦ä¹ ç¯å¢ƒè¿˜å¯ä»¥ï¼Œè®¾æ–½åŸºæœ¬å¤Ÿç”¨",
            "åŸ¹è®­æ•ˆæœä¸€èˆ¬ï¼Œç¬¦åˆé¢„æœŸ"
        ]
        
        # ç”Ÿæˆæµ‹è¯•æ•°æ®
        texts = []
        labels = []
        
        # æ·»åŠ æ­£é¢æ ·æœ¬
        for _ in range(200):
            text = random.choice(positive_texts)
            texts.append(text + "ï¼Œ" + random.choice(positive_texts))
            labels.append(1)  # æ­£é¢
        
        # æ·»åŠ è´Ÿé¢æ ·æœ¬
        for _ in range(200):
            text = random.choice(negative_texts)
            texts.append(text + "ï¼Œ" + random.choice(negative_texts))
            labels.append(-1)  # è´Ÿé¢
        
        # æ·»åŠ ä¸­æ€§æ ·æœ¬
        for _ in range(100):
            text = random.choice(neutral_texts)
            texts.append(text + "ï¼Œ" + random.choice(neutral_texts))
            labels.append(0)  # ä¸­æ€§
        
        df = pd.DataFrame({
            'text': texts,
            'sentiment_label': labels,
            'customer_id': np.random.randint(1, 1000, len(texts)),
            'created_at': pd.date_range(start='2024-01-01', periods=len(texts), freq='H')
        })
        
        df.to_csv(f"{self.output_dir}/sentiment_analysis_data.csv", index=False)
        print(f"âœ… æƒ…æ„Ÿåˆ†ææ•°æ®å·²ä¿å­˜åˆ° {self.output_dir}/sentiment_analysis_data.csv")
        
        return df
    
    def generate_recommendation_data(self):
        """ç”Ÿæˆæ¨èç³»ç»Ÿæµ‹è¯•æ•°æ®"""
        print("ç”Ÿæˆæ¨èç³»ç»Ÿæµ‹è¯•æ•°æ®...")
        
        n_users = 500
        n_products = 50
        
        # ç”Ÿæˆç”¨æˆ·-äº§å“äº¤äº’çŸ©é˜µ
        interactions = []
        
        products = [
            "æ³¨å†Œä¼šè®¡å¸ˆåŸ¹è®­", "åˆçº§ä¼šè®¡èŒç§°", "ä¸­çº§ä¼šè®¡èŒç§°",
            "ä¸“å‡æœ¬å­¦å†", "æœ¬ç§‘å­¦å†", "ç ”ç©¶ç”Ÿå­¦å†",
            "äººåŠ›èµ„æºç®¡ç†å¸ˆ", "ä¸€çº§å»ºé€ å¸ˆ", "äºŒçº§å»ºé€ å¸ˆ",
            "Javaå¼€å‘", "Pythonå¼€å‘", "Webå‰ç«¯å¼€å‘"
        ] * 5  # æ‰©å±•åˆ°50ä¸ªäº§å“
        
        for user_id in range(1, n_users + 1):
            # æ¯ä¸ªç”¨æˆ·ä¸5-15ä¸ªäº§å“æœ‰äº¤äº’
            n_interactions = random.randint(5, 15)
            user_products = random.sample(range(n_products), n_interactions)
            
            for product_id in user_products:
                # ç”Ÿæˆè¯„åˆ†ï¼ˆ1-5ï¼‰
                rating = random.choices([1, 2, 3, 4, 5], weights=[5, 10, 20, 35, 30])[0]
                
                # ç”Ÿæˆäº¤äº’ç±»å‹
                interaction_type = random.choices(
                    ['view', 'purchase', 'inquiry', 'favorite'],
                    weights=[50, 20, 20, 10]
                )[0]
                
                interactions.append({
                    'user_id': user_id,
                    'product_id': product_id,
                    'product_name': products[product_id],
                    'rating': rating,
                    'interaction_type': interaction_type,
                    'timestamp': datetime.now() - timedelta(days=random.randint(1, 365))
                })
        
        df = pd.DataFrame(interactions)
        df.to_csv(f"{self.output_dir}/recommendation_data.csv", index=False)
        print(f"âœ… æ¨èç³»ç»Ÿæ•°æ®å·²ä¿å­˜åˆ° {self.output_dir}/recommendation_data.csv")
        
        return df
    
    def generate_all_ai_test_data(self):
        """ç”Ÿæˆæ‰€æœ‰AIæµ‹è¯•æ•°æ®"""
        print("ğŸ¤– å¼€å§‹ç”ŸæˆAIåŠŸèƒ½æµ‹è¯•æ•°æ®é›†...")
        
        try:
            self.generate_sales_trend_data()
            self.generate_customer_churn_data()
            self.generate_sentiment_analysis_data()
            self.generate_recommendation_data()
            
            print("âœ… æ‰€æœ‰AIæµ‹è¯•æ•°æ®ç”Ÿæˆå®Œæˆï¼")
            print(f"ğŸ“ æ•°æ®ä¿å­˜åœ¨ç›®å½•: {self.output_dir}")
            
        except Exception as e:
            print(f"âŒ ç”ŸæˆAIæµ‹è¯•æ•°æ®æ—¶å‡ºé”™: {e}")

if __name__ == "__main__":
    generator = AITestDataGenerator()
    generator.generate_all_ai_test_data()
```

### 4. æ€§èƒ½æµ‹è¯•æ•°æ®è„šæœ¬

```bash
#!/bin/bash
# scripts/generate_performance_test_data.sh
# æ€§èƒ½æµ‹è¯•æ•°æ®ç”Ÿæˆè„šæœ¬

echo "ğŸš€ å¼€å§‹ç”Ÿæˆæ€§èƒ½æµ‹è¯•æ•°æ®..."

# åŠ è½½ç¯å¢ƒå˜é‡
source .env

# ç”Ÿæˆå¤§é‡æµ‹è¯•æ•°æ®
echo "ğŸ“Š ç”Ÿæˆå¤§é‡æµ‹è¯•æ•°æ®..."
python3 scripts/generate_test_data.py

echo "ğŸ¤– ç”ŸæˆAIåŠŸèƒ½æµ‹è¯•æ•°æ®..."
python3 scripts/generate_ai_test_data.py

# ç”Ÿæˆå‹åŠ›æµ‹è¯•ç”¨æˆ·
echo "ğŸ‘¥ ç”Ÿæˆå‹åŠ›æµ‹è¯•ç”¨æˆ·..."
python3 << 'EOF'
import psycopg2
import os

DATABASE_URL = os.getenv('DATABASE_URL')
conn = psycopg2.connect(DATABASE_URL)
cursor = conn.cursor()

# ç”Ÿæˆ1000ä¸ªæµ‹è¯•ç”¨æˆ·ç”¨äºå¹¶å‘æµ‹è¯•
users_data = []
for i in range(1000):
    username = f"perf_test_user_{i+1:04d}"
    password = '$2a$10$N.zmdr9k7uOCQb376NoUnuTJ8iAt6Z5EHsM7lbqxrDB3gF.eZBJvG'
    name = f"æ€§èƒ½æµ‹è¯•ç”¨æˆ·{i+1}"
    phone = f"139{i+1:08d}"
    
    users_data.append((username, password, name, phone, 2, 3, 1))

insert_sql = """
INSERT INTO users (username, password, name, phone, department_id, role_id, status, created_at, updated_at)
VALUES (%s, %s, %s, %s, %s, %s, %s, NOW(), NOW())
ON CONFLICT (username) DO NOTHING
"""

cursor.executemany(insert_sql, users_data)
conn.commit()

print(f"âœ… ç”Ÿæˆäº† {len(users_data)} ä¸ªæ€§èƒ½æµ‹è¯•ç”¨æˆ·")

cursor.close()
conn.close()
EOF

# åˆ›å»ºæµ‹è¯•æ•°æ®æ¸…ç†è„šæœ¬
echo "ğŸ§¹ åˆ›å»ºæ•°æ®æ¸…ç†è„šæœ¬..."
cat > scripts/cleanup_test_data.sql << 'EOF'
-- æ¸…ç†æµ‹è¯•æ•°æ®è„šæœ¬
-- æ³¨æ„ï¼šä»…æ¸…ç†æµ‹è¯•æ•°æ®ï¼Œä¿ç•™åŸºç¡€é…ç½®æ•°æ®

-- æ¸…ç†ä¸šåŠ¡æµ‹è¯•æ•°æ®
DELETE FROM tracking_records WHERE created_by IN (SELECT id FROM users WHERE username LIKE 'test_%' OR username LIKE 'perf_test_%');
DELETE FROM payments WHERE order_id IN (SELECT id FROM orders WHERE assigned_user_id IN (SELECT id FROM users WHERE username LIKE 'test_%' OR username LIKE 'perf_test_%'));
DELETE FROM orders WHERE assigned_user_id IN (SELECT id FROM users WHERE username LIKE 'test_%' OR username LIKE 'perf_test_%');
DELETE FROM customers WHERE assigned_user_id IN (SELECT id FROM users WHERE username LIKE 'test_%' OR username LIKE 'perf_test_%');
DELETE FROM leads WHERE assigned_user_id IN (SELECT id FROM users WHERE username LIKE 'test_%' OR username LIKE 'perf_test_%');

-- æ¸…ç†æµ‹è¯•ç”¨æˆ·
DELETE FROM users WHERE username LIKE 'test_%' OR username LIKE 'perf_test_%';

-- æ¸…ç†æµ‹è¯•æ´»åŠ¨
DELETE FROM campaign_daily_stats WHERE campaign_id IN (SELECT id FROM campaigns WHERE name LIKE '%æµ‹è¯•%');
DELETE FROM campaigns WHERE name LIKE '%æµ‹è¯•%';

-- é‡ç½®åºåˆ—
SELECT setval('users_id_seq', (SELECT MAX(id) FROM users));
SELECT setval('leads_id_seq', (SELECT MAX(id) FROM leads));
SELECT setval('customers_id_seq', (SELECT MAX(id) FROM customers));
SELECT setval('orders_id_seq', (SELECT MAX(id) FROM orders));
SELECT setval('campaigns_id_seq', (SELECT MAX(id) FROM campaigns));

COMMIT;
EOF

echo "âœ… æ€§èƒ½æµ‹è¯•æ•°æ®ç”Ÿæˆå®Œæˆï¼"
echo "ğŸ“‹ ç”Ÿæˆçš„æ•°æ®åŒ…æ‹¬ï¼š"
echo "  - å¤§é‡ä¸šåŠ¡æµ‹è¯•æ•°æ®ï¼ˆçº¿ç´¢ã€å®¢æˆ·ã€è®¢å•ç­‰ï¼‰"
echo "  - 1000ä¸ªæ€§èƒ½æµ‹è¯•ç”¨æˆ·è´¦æˆ·"
echo "  - AIåŠŸèƒ½æµ‹è¯•æ•°æ®é›†"
echo "  - æ•°æ®æ¸…ç†è„šæœ¬"
echo ""
echo "ğŸ”§ ä½¿ç”¨æ–¹æ³•ï¼š"
echo "  1. è¿è¡Œæ€§èƒ½æµ‹è¯•å‰å…ˆæ‰§è¡Œæ­¤è„šæœ¬"
echo "  2. æµ‹è¯•å®Œæˆåè¿è¡Œ: psql \$DATABASE_URL -f scripts/cleanup_test_data.sql"
```

### 5. æµ‹è¯•å·¥å…·å’Œè„šæœ¬

```python
# scripts/test_data_validator.py
"""
æµ‹è¯•æ•°æ®éªŒè¯è„šæœ¬
"""

import psycopg2
import os
from datetime import datetime

class TestDataValidator:
    def __init__(self):
        self.conn = psycopg2.connect(os.getenv('DATABASE_URL'))
        self.cursor = self.conn.cursor()
    
    def validate_data_integrity(self):
        """éªŒè¯æ•°æ®å®Œæ•´æ€§"""
        print("ğŸ” éªŒè¯æ•°æ®å®Œæ•´æ€§...")
        
        checks = [
            {
                'name': 'ç”¨æˆ·æ•°æ®å®Œæ•´æ€§',
                'sql': "SELECT COUNT(*) FROM users WHERE username IS NULL OR password IS NULL OR name IS NULL"
            },
            {
                'name': 'çº¿ç´¢åˆ†é…å®Œæ•´æ€§',
                'sql': "SELECT COUNT(*) FROM leads WHERE assigned_user_id NOT IN (SELECT id FROM users WHERE status = 1)"
            },
            {
                'name': 'å®¢æˆ·è®¢å•å…³è”å®Œæ•´æ€§',
                'sql': "SELECT COUNT(*) FROM orders WHERE customer_id NOT IN (SELECT id FROM customers WHERE status IN (1,2,3))"
            },
            {
                'name': 'æ”¯ä»˜è®¢å•å…³è”å®Œæ•´æ€§',
                'sql': "SELECT COUNT(*) FROM payments WHERE order_id NOT IN (SELECT id FROM orders)"
            },
            {
                'name': 'è·Ÿè¸ªè®°å½•å…³è”å®Œæ•´æ€§',
                'sql': """
                SELECT COUNT(*) FROM tracking_records 
                WHERE (lead_id IS NOT NULL AND lead_id NOT IN (SELECT id FROM leads))
                   OR (customer_id IS NOT NULL AND customer_id NOT IN (SELECT id FROM customers))
                """
            }
        ]
        
        all_passed = True
        for check in checks:
            self.cursor.execute(check['sql'])
            result = self.cursor.fetchone()[0]
            
            if result == 0:
                print(f"  âœ… {check['name']}: é€šè¿‡")
            else:
                print(f"  âŒ {check['name']}: å‘ç° {result} æ¡å¼‚å¸¸æ•°æ®")
                all_passed = False
        
        return all_passed
    
    def validate_business_rules(self):
        """éªŒè¯ä¸šåŠ¡è§„åˆ™"""
        print("ğŸ“‹ éªŒè¯ä¸šåŠ¡è§„åˆ™...")
        
        rules = [
            {
                'name': 'è®¢å•é‡‘é¢ä¸€è‡´æ€§',
                'sql': "SELECT COUNT(*) FROM orders WHERE total_amount != unit_price * quantity"
            },
            {
                'name': 'æ”¯ä»˜é‡‘é¢åˆç†æ€§',
                'sql': "SELECT COUNT(*) FROM payments p JOIN orders o ON p.order_id = o.id WHERE p.payment_amount > o.total_amount"
            },
            {
                'name': 'å®¢æˆ·çŠ¶æ€åˆç†æ€§',
                'sql': "SELECT COUNT(*) FROM customers WHERE status = 3 AND total_order_amount = 0"
            },
            {
                'name': 'çº¿ç´¢è½¬åŒ–çŠ¶æ€',
                'sql': "SELECT COUNT(*) FROM leads WHERE status = 3 AND id NOT IN (SELECT source_lead_id FROM customers WHERE source_lead_id IS NOT NULL)"
            }
        ]
        
        all_passed = True
        for rule in rules:
            self.cursor.execute(rule['sql'])
            result = self.cursor.fetchone()[0]
            
            if result == 0:
                print(f"  âœ… {rule['name']}: é€šè¿‡")
            else:
                print(f"  âš ï¸ {rule['name']}: å‘ç° {result} æ¡å¯èƒ½å¼‚å¸¸çš„æ•°æ®")
                all_passed = False
        
        return all_passed
    
    def generate_data_report(self):
        """ç”Ÿæˆæ•°æ®æŠ¥å‘Š"""
        print("ğŸ“Š ç”Ÿæˆæ•°æ®ç»Ÿè®¡æŠ¥å‘Š...")
        
        report = []
        
        # åŸºç¡€æ•°æ®ç»Ÿè®¡
        tables = [
            ('users', 'ç”¨æˆ·'),
            ('departments', 'éƒ¨é—¨'),
            ('roles', 'è§’è‰²'),
            ('leads', 'çº¿ç´¢'),
            ('customers', 'å®¢æˆ·'),
            ('orders', 'è®¢å•'),
            ('payments', 'æ”¯ä»˜è®°å½•'),
            ('tracking_records', 'è·Ÿè¸ªè®°å½•'),
            ('campaigns', 'æ¨å¹¿æ´»åŠ¨'),
            ('operation_logs', 'æ“ä½œæ—¥å¿—')
        ]
        
        for table, name in tables:
            self.cursor.execute(f"SELECT COUNT(*) FROM {table}")
            count = self.cursor.fetchone()[0]
            report.append(f"{name}: {count:,} æ¡")
        
        # ä¸šåŠ¡æ•°æ®åˆ†æ
        self.cursor.execute("""
        SELECT 
            l.status,
            CASE 
                WHEN l.status = 1 THEN 'å¾…è·Ÿè¿›'
                WHEN l.status = 2 THEN 'è·Ÿè¿›ä¸­'
                WHEN l.status = 3 THEN 'å·²è½¬åŒ–'
                WHEN l.status = 4 THEN 'æ— æ•ˆ'
            END as status_name,
            COUNT(*) as count
        FROM leads l
        GROUP BY l.status
        ORDER BY l.status
        """)
        
        lead_stats = self.cursor.fetchall()
        report.append("\nçº¿ç´¢çŠ¶æ€åˆ†å¸ƒ:")
        for stat in lead_stats:
            report.append(f"  {stat[1]}: {stat[2]:,} æ¡")
        
        # å®¢æˆ·çŠ¶æ€åˆ†æ
        self.cursor.execute("""
        SELECT 
            c.status,
            CASE 
                WHEN c.status = 1 THEN 'æ½œåœ¨å®¢æˆ·'
                WHEN c.status = 2 THEN 'è·Ÿè¿›ä¸­'
                WHEN c.status = 3 THEN 'å·²æˆå•'
                WHEN c.status = 4 THEN 'æµå¤±'
            END as status_name,
            COUNT(*) as count,
            COALESCE(SUM(c.total_order_amount), 0) as total_amount
        FROM customers c
        GROUP BY c.status
        ORDER BY c.status
        """)
        
        customer_stats = self.cursor.fetchall()
        report.append("\nå®¢æˆ·çŠ¶æ€åˆ†å¸ƒ:")
        for stat in customer_stats:
            report.append(f"  {stat[1]}: {stat[2]:,} æ¡, æ€»é‡‘é¢: Â¥{stat[3]:,.2f}")
        
        # è®¢å•çŠ¶æ€åˆ†æ
        self.cursor.execute("""
        SELECT 
            o.status,
            CASE 
                WHEN o.status = 1 THEN 'å¾…ç¡®è®¤'
                WHEN o.status = 2 THEN 'å·²ç¡®è®¤'
                WHEN o.status = 3 THEN 'å¾…ä»˜æ¬¾'
                WHEN o.status = 4 THEN 'è¿›è¡Œä¸­'
                WHEN o.status = 5 THEN 'å·²å®Œæˆ'
                WHEN o.status = 6 THEN 'å·²å–æ¶ˆ'
            END as status_name,
            COUNT(*) as count,
            COALESCE(SUM(o.total_amount), 0) as total_amount
        FROM orders o
        GROUP BY o.status
        ORDER BY o.status
        """)
        
        order_stats = self.cursor.fetchall()
        report.append("\nè®¢å•çŠ¶æ€åˆ†å¸ƒ:")
        for stat in order_stats:
            report.append(f"  {stat[1]}: {stat[2]:,} æ¡, æ€»é‡‘é¢: Â¥{stat[3]:,.2f}")
        
        # ä¿å­˜æŠ¥å‘Š
        report_content = "\n".join(report)
        
        with open(f"test_data_report_{datetime.now().strftime('%Y%m%d_%H%M%S')}.txt", 'w', encoding='utf-8') as f:
            f.write(f"CRMç³»ç»Ÿæµ‹è¯•æ•°æ®æŠ¥å‘Š\n")
            f.write(f"ç”Ÿæˆæ—¶é—´: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}\n")
            f.write("=" * 50 + "\n\n")
            f.write(report_content)
        
        print(report_content)
        print(f"\nğŸ“„ è¯¦ç»†æŠ¥å‘Šå·²ä¿å­˜åˆ°æ–‡ä»¶")
    
    def run_all_validations(self):
        """è¿è¡Œæ‰€æœ‰éªŒè¯"""
        print("ğŸ” å¼€å§‹éªŒè¯æµ‹è¯•æ•°æ®...")
        
        integrity_passed = self.validate_data_integrity()
        business_passed = self.validate_business_rules()
        
        if integrity_passed and business_passed:
            print("\nâœ… æ‰€æœ‰éªŒè¯é€šè¿‡ï¼Œæµ‹è¯•æ•°æ®è´¨é‡è‰¯å¥½")
        else:
            print("\nâš ï¸ å‘ç°æ•°æ®é—®é¢˜ï¼Œè¯·æ£€æŸ¥ä¸Šè¿°å¼‚å¸¸é¡¹")
        
        self.generate_data_report()
        
        self.cursor.close()
        self.conn.close()

if __name__ == "__main__":
    validator = TestDataValidator()
    validator.run_all_validations()
```

<function_calls>
<invoke name="todo_write">
<parameter name="merge">true
